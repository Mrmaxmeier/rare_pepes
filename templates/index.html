
<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8">
	<title>rare_pepes</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="https://rawgit.com/Semantic-Org/Semantic-UI/next/dist/semantic.min.css">
	<script src="https://rawgit.com/Semantic-Org/Semantic-UI/next/dist/semantic.min.js"></script>
	<style>
	.pepe {
		width: 100%;
		height: 100%;
		min-height: 100%;
		min-width: 100%;
		cursor: pointer;
	}
	</style>
</head>
<body>
	<nav class="ui menu inverted navbar page grid">
		<a href="#" class="brand active item">rare_pepes</a>
		<div class="right menu">
			<a href="#" class="item">tutorial</a>
			<a href="https://imgur.com/a/U2dTR" class="item">rare pepes, do not steel</a>
			<!--<div class="ui segment" style="padding: 0.5rem;">
				<div class="ui toggle checkbox checked">
					<input type="checkbox">
					<label>NSFW</label>
				</div>
			</div>-->
			<p class="item">{{num_pepes}} total pepes</p>
		</div>
	</nav>
	<div class="ui two column middle aligned very relaxed fitted stackable grid">
		<div class="column">
			<img id="p1" class="pepe"/>
		</div>
		<div class="ui vertical divider">Or</div>
		<div class="column">
			<img id="p2" class="pepe"/>
		</div>
	</div>
	<script>
	$(".ui.checkbox").checkbox();

	var p1;
	var p2;

	function update_pepes(data) {
		console.log("got pepes", data)
		p1 = data[0];
		p2 = data[1];

		$("#p1").attr("src", p1.link)
		$("#p2").attr("src", p2.link)
	}

	$("#p1").on("click", function() {vote("p1")})
	$("#p2").on("click", function() {vote("p2")})

	function vote(pepe) {
		switch (pepe) {
			case "p1":
				pepe = p1;
				break
			case "p2":
				pepe = p2;
				break
		}
		console.log("voting for", pepe.id)
		var xhr = new XMLHttpRequest();
		xhr.open('POST', '/api/vote/'+pepe.id, true);
		xhr.send(null);
		xhr.onreadystatechange = function(e) {
			if (xhr.response) {
				var data = JSON.parse(xhr.response)
				xhr.abort()
				update_pepes(data)
			}
		}

	}


	$.post("/api/get_pepes", {}, update_pepes)
	</script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8">
	<title>rare_pepes</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="https://rawgit.com/Semantic-Org/Semantic-UI/next/dist/semantic.min.css">
	<script src="https://rawgit.com/Semantic-Org/Semantic-UI/next/dist/semantic.min.js"></script>
	<style>
	.pepe {
		width: 100%;
		height: 100%;
		min-height: 100%;
		min-width: 100%;
		cursor: pointer;
	}
	</style>
</head>
<body>
	<nav class="ui menu inverted navbar page grid">
		<a href="/" class="brand active item">rare_pepes</a>
		<div class="right menu">
			<a href="#" class="item" onclick="$('.ui.modal').modal('show')">tutorial</a>
			<a href="/single_pepe_mode" class="item">single-pepe-mode</a>
			<a href="https://imgur.com/a/U2dTR" class="item">rare pepes, do not steel</a>
			<!--<div class="ui segment" style="padding: 0.5rem;">
				<div class="ui toggle checkbox checked">
					<input type="checkbox">
					<label>NSFW</label>
				</div>
			</div>-->
			<p class="item">{{num_pepes}} pepes on record</p>
		</div>
	</nav>
	<div class="ui two column middle aligned very relaxed fitted stackable grid">
		<div class="column" id="p1c">
			<img id="p1" class="pepe"/>
			<div id="p1dimmer" class="ui dimmer">
				<div class="ui text loader">Loading</div>
			</div>
		</div>
		<div class="ui vertical divider">Or</div>
		<div class="column" id="p2c">
			<img id="p2" class="pepe"/>
			<div id="p2dimmer" class="ui dimmer">
				<div class="ui text loader">Loading</div>
			</div>
		</div>
	</div>

<div class="ui modal">
  <i class="close icon"></i>
  <div class="header">
    Tutorial
  </div>
  <div class="content">
    <div class="ui medium image">
      <img src="http://i3.kym-cdn.com/photos/images/original/000/862/065/0e9.jpg">
    </div>
    <div class="description">
      <div class="ui header">How does this work?</div>
      <p>Every turn you're presented with two pepes.</p>
      <p>Click on the pepe you're the least fammiliar with.</p>
    </div>
  </div>
  <div class="actions">
    <div class="ui positive right labeled icon button">
      Ok
      <i class="checkmark icon"></i>
    </div>
  </div>
</div>


	<script>
	$(".ui.checkbox").checkbox();

	var p1;
	var p2;
	var p1_loader_timeout;
	var p2_loader_timeout;

	function update_pepes(data) {
		console.log("got pepes", data)
		p1 = data[0];
		p2 = data[1];
		p1_loader_timeout = setTimeout(function(){
			$("#p1dimmer").addClass("active")
		}, 500);
		p2_loader_timeout = setTimeout(function(){
			$("#p2dimmer").addClass("active")
		}, 500);
		$("#p1").attr("src", p1.link)
		$("#p2").attr("src", p2.link)
	}

	$("#p1").on("click", function() {vote("p1")})
	$("#p2").on("click", function() {vote("p2")})

	$("#p1").bind("load", function() {
		$("#p1dimmer").removeClass("active")
		clearTimeout(p1_loader_timeout)
	})
	$("#p2").bind("load", function() {
		$("#p2dimmer").removeClass("active")
		clearTimeout(p2_loader_timeout)
	})

	$(document).keypress(function(e) {
		switch (e.keyCode) {
			case 97:
				//a
				vote("p1")
				break;
			case 100:
				//d
				vote("p2")
				break;
		}
	});

	function vote(pepe) {
		switch (pepe) {
			case "p1":
				pepe = p1;
				break
			case "p2":
				pepe = p2;
				break
		}
		console.log("voting for", pepe.id)
		var xhr = new XMLHttpRequest();
		xhr.open('POST', '/api/vote/'+pepe.id, true);
		xhr.send(null);
		xhr.onreadystatechange = function(e) {
			if (xhr.response) {
				var data = JSON.parse(xhr.response)
				xhr.abort()
				update_pepes(data)
			}
		}

	}


	$.post("/api/get_pepes", {}, update_pepes)
	</script>
</body>
</html>